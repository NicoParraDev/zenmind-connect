{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenMindConnect | Lista de Pacientes</title>
    <link rel="icon" href="{% static 'IMG/logo_final.png' %}">
    
    <!-- ZenMindConnect 2.0 CSS -->
    <link rel="stylesheet" href="{% static 'CSS/zenmind_2.0_base.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/zenmind_2.0_navbar.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/zenmind_2.0_components.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/zenmind_2.0_usuarios.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/zenmind_2.0_interactive.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/style_notificaciones.css' %}">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    {% include 'core/navbar.html' %}

    <!-- Main Content -->
    <main class="main-content">
        <div class="usuarios-container">
            <div class="usuarios-header">
                <h1>
                    <i class="fas fa-users"></i> Lista de Pacientes
                </h1>
                <p class="subtitle">Gestiona y visualiza todos los usuarios registrados en el sistema</p>
            </div>

            <!-- Barra de búsqueda -->
            <div class="search-bar">
                <form method="GET" action="{% url 'lista_usuarios' %}" class="search-bar-content">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input 
                            type="text" 
                            name="q" 
                            class="search-input" 
                            placeholder="Buscar por RUT, nombre, apellido o email..." 
                            value="{{ query }}"
                            id="searchInput"
                            autocomplete="off"
                        >
                    </div>
                    {% if query %}
                        <a href="{% url 'lista_usuarios' %}" class="btn-clear-search">
                            <i class="fas fa-times"></i> Limpiar
                        </a>
                    {% endif %}
                    <button type="submit" class="btn-primary" style="padding: 0.75rem 1.5rem;">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </form>
                <div class="search-stats" style="margin-top: 1rem;">
                    <i class="fas fa-info-circle"></i>
                    <span>
                        {% if query %}
                            Mostrando <strong>{{ total }}</strong> resultado{{ total|pluralize }} para "{{ query }}"
                        {% else %}
                            Total de pacientes: <strong>{{ total }}</strong>
                        {% endif %}
                    </span>
                </div>
            </div>

            <!-- Tabla de usuarios -->
            {% if datos %}
                <div class="table-container">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-id-card"></i> RUT</th>
                                <th><i class="fas fa-user"></i> Nombre Completo</th>
                                <th><i class="fas fa-birthday-cake"></i> Fecha Nacimiento</th>
                                <th><i class="fas fa-envelope"></i> Email</th>
                                <th><i class="fas fa-phone"></i> Teléfono</th>
                                <th><i class="fas fa-user-tag"></i> Tipo Usuario</th>
                                <th><i class="fas fa-cog"></i> Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for persona in datos %}
                                <tr>
                                    <td>
                                        <span class="user-rut">{{ persona.rut }}</span>
                                    </td>
                                    <td>
                                        <div class="user-name">{{ persona.nombre }} {{ persona.apellido }}</div>
                                        <div class="user-email" style="font-size: 0.85rem; margin-top: 0.25rem;">
                                            <i class="fas fa-user-circle"></i> {{ persona.user.username }}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="user-date">{{ persona.fechaNac|date:"d/m/Y" }}</div>
                                    </td>
                                    <td>
                                        <div class="user-email">{{ persona.correo }}</div>
                                    </td>
                                    <td>
                                        <div class="user-phone">{{ persona.telefono }}</div>
                                    </td>
                                    <td>
                                        <span style="background: var(--accent-color-light); color: var(--accent-color); padding: 0.3rem 0.8rem; border-radius: var(--border-radius); font-size: 0.85rem; font-weight: 600;">
                                            {{ persona.tipousuario.tipoUsuario }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <a href="{% url 'form_borrar_persona' persona.rut %}" 
                                               class="btn-action btn-delete"
                                               onclick="return confirm('¿Estás seguro de que deseas eliminar a {{ persona.nombre }} {{ persona.apellido }}? Esta acción no se puede deshacer.');">
                                                <i class="fas fa-trash"></i> Eliminar
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    
                    <!-- Paginación -->
                    {% if page_obj.has_other_pages %}
                        <div class="pagination-wrapper">
                            <div class="pagination-info">
                                <i class="fas fa-info-circle"></i>
                                Mostrando página <strong>{{ page_obj.number }}</strong> de <strong>{{ paginator.num_pages }}</strong>
                                (Total: <strong>{{ total }}</strong> paciente{{ total|pluralize }})
                            </div>
                            <div class="pagination-controls">
                                {% if page_obj.has_previous %}
                                    <a href="?page=1{% if query %}&q={{ query }}{% endif %}" class="pagination-btn" title="Primera página">
                                        <i class="fas fa-angle-double-left"></i>
                                    </a>
                                    <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" class="pagination-btn" title="Página anterior">
                                        <i class="fas fa-angle-left"></i>
                                    </a>
                                {% else %}
                                    <span class="pagination-btn disabled" title="Primera página">
                                        <i class="fas fa-angle-double-left"></i>
                                    </span>
                                    <span class="pagination-btn disabled" title="Página anterior">
                                        <i class="fas fa-angle-left"></i>
                                    </span>
                                {% endif %}
                                
                                <span class="pagination-current">
                                    Página {{ page_obj.number }} de {{ paginator.num_pages }}
                                </span>
                                
                                {% if page_obj.has_next %}
                                    <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}" class="pagination-btn" title="Página siguiente">
                                        <i class="fas fa-angle-right"></i>
                                    </a>
                                    <a href="?page={{ paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}" class="pagination-btn" title="Última página">
                                        <i class="fas fa-angle-double-right"></i>
                                    </a>
                                {% else %}
                                    <span class="pagination-btn disabled" title="Página siguiente">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                    <span class="pagination-btn disabled" title="Última página">
                                        <i class="fas fa-angle-double-right"></i>
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        <div class="pagination-info-simple">
                            <i class="fas fa-info-circle"></i>
                            Mostrando <strong>{{ total }}</strong> paciente{{ total|pluralize }}
                        </div>
                    {% endif %}
                    
                    <div class="table-footer">
                        <div class="table-actions">
                            <a href="{% url 'adm' %}" class="btn-back">
                                <i class="fas fa-arrow-left"></i> Volver a Administración
                            </a>
                            <a href="{% url 'index' %}" class="btn-back" style="background: var(--bg-secondary); color: var(--text-primary); border: 2px solid var(--border-color);">
                                <i class="fas fa-home"></i> Ir al Inicio
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="no-results">
                    <div class="no-results-icon">
                        <i class="fas fa-user-slash"></i>
                    </div>
                    <h3>No se encontraron pacientes</h3>
                    <p>
                        {% if query %}
                            No hay resultados para "{{ query }}". Intenta con otro término de búsqueda.
                        {% else %}
                            Aún no hay pacientes registrados en el sistema.
                        {% endif %}
                    </p>
                    {% if query %}
                        <a href="{% url 'lista_usuarios' %}" class="btn-back">
                            <i class="fas fa-redo"></i> Ver Todos los Pacientes
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer -->
    {% include 'core/footer.html' %}

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'JS/zenmind_2.0_interactive.js' %}"></script>
    <script>
        // Búsqueda en tiempo real (opcional, mejora UX)
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const form = searchInput.closest('form');
            
            // Auto-submit después de 500ms sin escribir (opcional)
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                // Puedes habilitar esto si quieres búsqueda en tiempo real
                // searchTimeout = setTimeout(() => {
                //     form.submit();
                // }, 500);
            });
            
            // Enter para buscar
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    form.submit();
                }
            });
        });
    </script>
</body>
</html>
